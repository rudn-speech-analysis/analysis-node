name: speech-analysis
channels:
  - conda-forge
  - nodefaults
dependencies:
  - python=3.13

  - numpy
  - pandas
  - scipy
  - matplotlib
  - pillow

  - jupyter
  - jupyterlab<4.5.0
  - jupyterlab_vim
  - ipykernel<7.0.0

  - huggingface_hub

  - transformers=4.57
  - accelerate

  - einops

  - librosa
  - pydub
  - audioop-lts
  - libsndfile

  - tqdm

  - pyyaml
  - kafka-python
  - boto3
  - dacite

  - pip
  - pip:
      - openai-whisper
      - speechbrain

      - triton @ https://repo.radeon.com/rocm/manylinux/rocm-rel-7.1.1/triton-3.4.0%2Brocm7.1.1.git0cace8d2-cp313-cp313-linux_x86_64.whl
      - torchaudio @ https://repo.radeon.com/rocm/manylinux/rocm-rel-7.1.1/torchaudio-2.8.0%2Brocm7.1.1.git6e1c7fe9-cp313-cp313-linux_x86_64.whl
      - torch @ https://repo.radeon.com/rocm/manylinux/rocm-rel-7.1.1/torch-2.8.0%2Brocm7.1.1.lw.gitcba8b9d2-cp313-cp313-linux_x86_64.whl
      - torchinfo
      # - torchcodec

      - pyannote-audio @ git+https://github.com/rudn-speech-analysis/pyannote-audio.git
      - omegaconf

variables:
  FLASH_ATTENTION_TRITON_AMD_ENABLE: "TRUE"
  # Not settings this despite recomendations for speedup as this doesn't work on gfx1201
  # FLASH_ATTENTION_TRITON_AMD_AUTOTUNE: "TRUE"
  DS_BUILD_ROCm: 1
  # Installing pyannote-audio from git sets version to something like 0.0.1,
  # which breaks some dependency checks
  PYANNOTE_SKIP_DEPENDENCY_CHECK: 1
